<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Account Settings - Skin Disease Detector</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', path='/style.css') }}">
</head>

<body>
    <nav class="navbar">
        <div class="nav-container"
            style="max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; padding: 15px 20px;">
            <div class="nav-brand"
                style="font-size: 24px; font-weight: 800; display: flex; align-items: center; gap: 10px;">
                <span class="logo">üî¨</span>
                <span class="text-gradient">DermatoScan AI</span>
            </div>
            <div class="nav-links" style="display: flex; gap: 10px; align-items: center;">
                <span class="user-info" style="color: var(--text-muted); margin-right: 15px; font-size: 14px;">{{
                    user.email }}</span>
                <a href="/dashboard" class="btn btn-secondary" style="padding: 8px 16px;">Dashboard</a>
                <a href="/history" class="btn btn-secondary" style="padding: 8px 16px;">History</a>
                <a href="/account" class="btn btn-primary" style="padding: 8px 16px;">Account</a>
            </div>
        </div>
    </nav>

    <div class="main-container" style="max-width: 800px; margin: 40px auto; padding: 0 20px;">
        <div class="page-header card glass-panel" style="margin-bottom: 30px; animation: fadeIn 0.8s ease-out;">
            <h1>Profile Management</h1>
            <p style="color: var(--text-muted);">Configure your identity and security preferences.</p>
        </div>

        <div class="account-section card glass-panel" style="margin-bottom: 30px;">
            <h2 style="margin-bottom: 25px;">Account Information</h2>
            <div class="account-info" style="display: grid; gap: 15px;">
                <div class="info-item"
                    style="display: flex; justify-content: space-between; padding: 15px; background: rgba(255,255,255,0.03); border-radius: 12px; border: 1px solid var(--glass-border);">
                    <span class="info-label" style="font-weight: 600;">Email Instance</span>
                    <span class="info-value" style="color: var(--primary);">{{ user.email }}</span>
                </div>
                <div class="info-item"
                    style="display: flex; justify-content: space-between; padding: 15px; background: rgba(255,255,255,0.03); border-radius: 12px; border: 1px solid var(--glass-border);">
                    <span class="info-label" style="font-weight: 600;">Account Created</span>
                    <span class="info-value">{{ user.created_at }}</span>
                </div>
                <div class="info-item"
                    style="display: flex; justify-content: space-between; padding: 15px; background: rgba(255,255,255,0.03); border-radius: 12px; border: 1px solid var(--glass-border);">
                    <span class="info-label" style="font-weight: 600;">Access Tier</span>
                    <span class="info-value">
                        {% if user.is_admin %}
                        <span style="color: var(--accent); font-weight: 700;">PRO ADMINISTRATOR</span>
                        {% else %}
                        Standard Clinician
                        {% endif %}
                    </span>
                </div>
            </div>
        </div>

        <div class="account-section card glass-panel" style="margin-bottom: 30px;">
            <h2 style="margin-bottom: 25px;">Metric Overview</h2>
            <div class="stats-grid"
                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 20px;">
                <div class="stat-card"
                    style="padding: 20px; border-radius: 16px; background: rgba(99, 102, 241, 0.1); text-align: center; border: 1px solid rgba(99, 102, 241, 0.2);">
                    <div class="stat-number" id="total-predictions"
                        style="font-size: 28px; font-weight: 800; color: var(--primary);">-</div>
                    <div class="stat-label" style="font-size: 12px; color: var(--text-muted);">Lifetime Analysed</div>
                </div>
                <div class="stat-card"
                    style="padding: 20px; border-radius: 16px; background: rgba(236, 72, 153, 0.1); text-align: center; border: 1px solid rgba(236, 72, 153, 0.2);">
                    <div class="stat-number" id="this-month"
                        style="font-size: 28px; font-weight: 800; color: var(--secondary);">-</div>
                    <div class="stat-label" style="font-size: 12px; color: var(--text-muted);">Monthly Velocity</div>
                </div>
                <div class="stat-card"
                    style="padding: 20px; border-radius: 16px; background: rgba(245, 158, 11, 0.1); text-align: center; border: 1px solid rgba(245, 158, 11, 0.2);">
                    <div class="stat-number" id="avg-confidence"
                        style="font-size: 28px; font-weight: 800; color: var(--accent);">-</div>
                    <div class="stat-label" style="font-size: 12px; color: var(--text-muted);">Inference Quality</div>
                </div>
            </div>
        </div>

        <div class="account-section card glass-panel"
            style="margin-bottom: 30px; border-color: rgba(239, 68, 68, 0.3);">
            <h2 style="color: #ef4444; margin-bottom: 15px;">‚ö†Ô∏è Critical Configuration</h2>
            <p style="color: var(--text-muted); margin-bottom: 25px;">Termination of this account will purge all
                associated diagnostic models and history logs.</p>

            {% if error %}
            <div class="error"
                style="background: rgba(239, 68, 68, 0.2); padding: 12px; border-radius: 12px; margin-bottom: 20px; text-align: center;">
                {{ error }}</div>
            {% endif %}

            <form method="post" action="/delete-account" onsubmit="return confirmDelete()">
                <div class="form-group" style="margin-bottom: 20px;">
                    <label for="password" style="display: block; margin-bottom: 8px;">Verify Identity
                        (Password):</label>
                    <div class="password-input-wrapper" style="position: relative;">
                        <input type="password" id="password" name="password" required>
                        <button type="button" class="toggle-password" onclick="togglePassword()"
                            style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; color: var(--text-muted);">
                            üëÅÔ∏è
                        </button>
                    </div>
                </div>
                <button type="submit" class="btn btn-secondary"
                    style="width: 100%; color: #ef4444; border-color: #ef4444; font-weight: 700;">
                    üóëÔ∏è Request Account Termination
                </button>
            </form>
        </div>
    </div>

    <script>
        fetch('/history')
            .then(response => response.text())
            .then(html => {
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const predictions = doc.querySelectorAll('.prediction-card');
                document.getElementById('total-predictions').textContent = predictions.length;

                const currentDate = new Date();
                const currentMonth = currentDate.getMonth();
                const currentYear = currentDate.getFullYear();
                let thisMonthCount = 0;
                let totalConfidence = 0;

                const confidences = doc.querySelectorAll('.confidence-value');
                confidences.forEach(el => totalConfidence += parseFloat(el.textContent));

                // Simplified month check
                document.getElementById('this-month').textContent = predictions.length; // Placeholder
                document.getElementById('avg-confidence').textContent = confidences.length > 0 ?
                    (totalConfidence / confidences.length).toFixed(1) + '%' : '0%';
            });

        function togglePassword() {
            const passwordField = document.getElementById('password');
            const toggleButton = document.querySelector('.toggle-password');
            passwordField.type = passwordField.type === 'password' ? 'text' : 'password';
            toggleButton.textContent = passwordField.type === 'password' ? 'üëÅÔ∏è' : 'üôà';
        }

        function confirmDelete() {
            return confirm('‚ö†Ô∏è IRREVERSIBLE ACTION: Are you absolutely certain you wish to purge this account profile and all forensic data?');
        }
    </script>
</body>

</html>